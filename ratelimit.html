<!-- Define setting UI for weather-data node -->
<script type="text/html" data-template-name="rate-limiter">
    <div id="rate-details">
	       <div class="form-row">
            <label for="node-input-rate"><i class="fa fa-clock-o"></i> Rate</label>
            <input type="number" id="node-input-rate" placeholder="1" style="text-align:end; width:60px !important">
            <label for="node-input-rate"> msg(s) per</label>
            <input type="number" id="node-input-nbRateUnits" placeholder="1" style="text-align:end; width:60px !important">
            <select id="node-input-rateUnits" style="width:90px !important">
              <option value="second">Seconds</option>
              <option value="minute">Minutes</option>
              <option value="hour">Hours</option>
              <option value="day">Days</option>
            </select>
        </div>
	</div>
    <div class="form-row" style="display: flex; align-items: center">
        <input style="width:30px; margin:0" type="checkbox" id="node-input-addcurrentcount">
        <label style="margin:0;width: auto;" for="node-input-addcurrentcount">Add current counter to message (msg.CurrentCount)</label>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>

<!-- register rate-limiter node -->
<script type="text/javascript">
    RED.nodes.registerType('rate-limiter',{
        category: 'function',
        color: '#E6E0F8',
        defaults: {
            rate: {
                value:"1",
                required:true,
                label:"Rate",
             },
            nbRateUnits: {
                value:"1",
                required:true,
            },
            rateUnits: {value: "second"},
            addcurrentcount: {value: false},
			name: {value:""}
        },
        inputs:1,
        outputs:2,
        icon: "font-awesome/fa-clock-o",
        label: function() {
            if (this.name) {
                return this.name;
            }
			var rateTxt = this.rate+" msg/"+(this.rateUnits ? (this.nbRateUnits > 1 ? this.nbRateUnits : '') + this.rateUnits.charAt(0) : "s");
                
            //return "rate limit " + this.rate + " msg/" + this.duration + "ms";
			return "rate limit " + rateTxt;
        }
    });
</script>

<script type="text/html" data-help-name="rate-limiter">
    <p>A simple node that offers rate limiting based on a sliding window.</p>
</script>
